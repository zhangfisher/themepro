<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>PopupController å†…å®¹å…‹éš†æµ‹è¯•</title>
        <script type="module" src="../dist/index.js"></script>
        <style>
            body {
                font-family: Arial, sans-serif;
                padding: 20px;
            }
            test-container {
                display: block;
                margin: 20px 0;
            }
            .test-section {
                margin: 30px 0;
                padding: 20px;
                border: 1px solid #e0e0e0;
                border-radius: 8px;
                background: #fafafa;
            }
            .log {
                margin-top: 20px;
                padding: 10px;
                background: #f5f5f5;
                border-radius: 4px;
                font-family: monospace;
                font-size: 12px;
                max-height: 300px;
                overflow-y: auto;
            }
        </style>
    </head>
    <body>
        <h1>PopupController å†…å®¹å…‹éš†åŠŸèƒ½æµ‹è¯•</h1>

        <div class="test-section">
            <h2>åŸºç¡€å†…å®¹å…‹éš†æµ‹è¯•</h2>
            <p>éªŒè¯ PopupController æ˜¯å¦æ­£ç¡®å¤„ç†å†…å®¹å…‹éš†</p>

            <auto-dropdown id="basic-test" label="åŸºç¡€æµ‹è¯•" type="primary">
                <div
                    style="
                        padding: 12px;
                        background: white;
                        border: 1px solid #d9d9d9;
                        border-radius: 6px;
                    "
                >
                    <p>è¿™æ˜¯å…‹éš†çš„å†…å®¹</p>
                    <ul>
                        <li>é€‰é¡¹ 1</li>
                        <li>é€‰é¡¹ 2</li>
                        <li>é€‰é¡¹ 3</li>
                    </ul>
                </div>
            </auto-dropdown>
        </div>

        <div class="test-section">
            <h2>å¤æ‚å†…å®¹å…‹éš†æµ‹è¯•</h2>
            <p>æµ‹è¯•å¤æ‚ HTML ç»“æ„çš„å†…å®¹å…‹éš†</p>

            <auto-dropdown id="complex-test" label="å¤æ‚æµ‹è¯•" type="success">
                <div
                    style="
                        padding: 16px;
                        background: white;
                        border: 1px solid #d9d9d9;
                        border-radius: 8px;
                        min-width: 300px;
                    "
                >
                    <h4 style="margin: 0 0 12px 0; color: #52c41a">
                        ğŸ“‹ ä»»åŠ¡åˆ—è¡¨
                    </h4>
                    <div style="margin-bottom: 12px">
                        <label style="display: block; margin-bottom: 4px">
                            <input type="checkbox" checked /> å®Œæˆæ–‡æ¡£ç¼–å†™
                        </label>
                        <label style="display: block; margin-bottom: 4px">
                            <input type="checkbox" /> ä»£ç å®¡æŸ¥
                        </label>
                        <label style="display: block; margin-bottom: 4px">
                            <input type="checkbox" /> å•å…ƒæµ‹è¯•
                        </label>
                    </div>
                    <button
                        style="
                            padding: 8px 16px;
                            background: #52c41a;
                            color: white;
                            border: none;
                            border-radius: 4px;
                            cursor: pointer;
                        "
                    >
                        æ·»åŠ æ–°ä»»åŠ¡
                    </button>
                </div>
            </auto-dropdown>
        </div>

        <div class="test-section">
            <h2>é‡å¤ç‚¹å‡»æµ‹è¯•</h2>
            <p>éªŒè¯å†…å®¹ä¸ä¼šé‡å¤å…‹éš†</p>

            <auto-dropdown id="repeat-test" label="é‡å¤ç‚¹å‡»æµ‹è¯•" type="warning">
                <div
                    style="
                        padding: 12px;
                        background: white;
                        border: 1px solid #d9d9d9;
                        border-radius: 6px;
                    "
                >
                    <p id="content-counter">è¿™ä¸ªå†…å®¹åªåº”è¯¥è¢«å…‹éš†ä¸€æ¬¡</p>
                </div>
            </auto-dropdown>
        </div>

        <div id="test-log" class="log"><strong>æµ‹è¯•æ—¥å¿—:</strong><br /></div>

        <script>
            const log = document.getElementById("test-log");

            function addLog(message, type = "info") {
                const timestamp = new Date().toLocaleTimeString();
                const icon =
                    type === "success" ? "âœ…" : type === "error" ? "âŒ" : "â„¹ï¸";
                log.innerHTML += `[${timestamp}] ${icon} ${message}<br>`;
                log.scrollTop = log.scrollHeight;
                console.log(message);
            }

            // ç›‘å¬æ‰€æœ‰dropdownäº‹ä»¶
            document.addEventListener("DOMContentLoaded", () => {
                const dropdowns = document.querySelectorAll("auto-dropdown");

                dropdowns.forEach((dropdown, index) => {
                    dropdown.addEventListener("dropdown-show", () => {
                        addLog(`Dropdown ${index + 1} æ˜¾ç¤º`, "success");

                        // æ£€æŸ¥å®¹å™¨å†…å®¹
                        setTimeout(() => {
                            const popupContainers = document.querySelectorAll(
                                ".kylinbits-container .popup"
                            );
                            if (popupContainers[index]) {
                                const childCount =
                                    popupContainers[index].children.length;
                                addLog(
                                    `Popup ${
                                        index + 1
                                    } åŒ…å« ${childCount} ä¸ªå­å…ƒç´ `
                                );

                                if (childCount > 0) {
                                    addLog(`âœ… å†…å®¹å…‹éš†æˆåŠŸ`, "success");

                                    // ç‰¹æ®Šæµ‹è¯•ï¼šæ£€æŸ¥é‡å¤ç‚¹å‡»
                                    if (dropdown.id === "repeat-test") {
                                        const counter =
                                            document.getElementById(
                                                "content-counter"
                                            );
                                        if (counter) {
                                            const clonedCount =
                                                document.querySelectorAll(
                                                    "#content-counter"
                                                ).length;
                                            addLog(
                                                `#content-counter å…ƒç´ æ•°é‡: ${clonedCount}`
                                            );
                                            if (clonedCount === 1) {
                                                addLog(
                                                    `âœ… æ— é‡å¤å…‹éš†`,
                                                    "success"
                                                );
                                            } else {
                                                addLog(
                                                    `âŒ å­˜åœ¨é‡å¤å…‹éš†`,
                                                    "error"
                                                );
                                            }
                                        }
                                    }
                                } else {
                                    addLog(`âŒ å†…å®¹å…‹éš†å¤±è´¥`, "error");
                                }
                            }
                        }, 100);
                    });

                    dropdown.addEventListener("dropdown-hide", () => {
                        addLog(`Dropdown ${index + 1} éšè—`);
                    });
                });

                addLog("ğŸš€ æµ‹è¯•ç¯å¢ƒåˆå§‹åŒ–å®Œæˆ");
                addLog("ğŸ’¡ è¯·ç‚¹å‡»å„ä¸ªä¸‹æ‹‰èœå•è¿›è¡Œæµ‹è¯•");
            });
        </script>
    </body>
</html>
