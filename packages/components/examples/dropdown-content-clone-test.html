<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dropdown å†…å®¹å…‹éš†ä¿®å¤éªŒè¯</title>
    <script type="module" src="../dist/index.js"></script>
</head>
<body>
    <div style="padding: 20px; font-family: Arial, sans-serif;">
        <h1>Dropdown å†…å®¹å…‹éš†ä¿®å¤éªŒè¯</h1>

        <h2>æµ‹è¯•å†…å®¹å…‹éš†</h2>
        <p>éªŒè¯ .dropdown-content å†…éƒ¨å†…å®¹æ˜¯å¦æ­£ç¡®å…‹éš†åˆ° _dropdownContainer</p>

        <div style="display: flex; gap: 20px; flex-wrap: wrap; margin: 20px 0;">
            <auto-dropdown id="test-dropdown-1" label="æµ‹è¯•1" type="primary">
                <div class="dropdown" style="padding: 8px 0; min-width: 160px; background: white; border: 1px solid #d9d9d9; border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                    <div style="padding: 8px 16px; cursor: pointer; color: #1890ff;">ğŸ”µ é€‰é¡¹ 1</div>
                    <div style="padding: 8px 16px; cursor: pointer; color: #52c41a;">ğŸŸ¢ é€‰é¡¹ 2</div>
                    <div style="padding: 8px 16px; cursor: pointer; color: #faad14;">ğŸŸ¡ é€‰é¡¹ 3</div>
                    <hr style="margin: 4px 0; border: none; border-top: 1px solid #e0e0e0;">
                    <div style="padding: 8px 16px; cursor: pointer; color: #ff4d4f;">ğŸ”´ å±é™©é€‰é¡¹</div>
                </div>
            </auto-dropdown>

            <auto-dropdown id="test-dropdown-2" label="æµ‹è¯•2" type="info">
                <ul style="padding: 8px 0; min-width: 140px; background: white; border: 1px solid #d9d9d9; border-radius: 6px; list-style: none; margin: 0;">
                    <li style="padding: 8px 16px; cursor: pointer;">ğŸ“ æ–‡æ¡£</li>
                    <li style="padding: 8px 16px; cursor: pointer;">âš™ï¸ è®¾ç½®</li>
                    <li style="padding: 8px 16px; cursor: pointer;">ğŸšª é€€å‡º</li>
                </ul>
            </auto-dropdown>
        </div>

        <div id="log-output" style="margin-top: 20px; padding: 10px; background: #f9f9f9; border: 1px solid #e0e0e0; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto;">
            <strong>éªŒè¯æ—¥å¿—:</strong><br>
        </div>

        <div style="margin-top: 20px;">
            <button onclick="testContentCloning()" style="padding: 10px 20px; background: #1890ff; color: white; border: none; cursor: pointer; border-radius: 4px; margin-right: 10px;">
                éªŒè¯å†…å®¹å…‹éš†
            </button>
            <button onclick="clearLog()" style="padding: 10px 20px; background: #f0f0f0; border: 1px solid #ccc; cursor: pointer; border-radius: 4px;">
                æ¸…ç©ºæ—¥å¿—
            </button>
        </div>

        <script>
            const logOutput = document.getElementById('log-output');

            function log(message) {
                const timestamp = new Date().toLocaleTimeString();
                logOutput.innerHTML += `[${timestamp}] ${message}<br>`;
                logOutput.scrollTop = logOutput.scrollHeight;
                console.log(message);
            }

            function clearLog() {
                logOutput.innerHTML = '<strong>éªŒè¯æ—¥å¿—:</strong><br>';
            }

            function testContentCloning() {
                log('ğŸ” å¼€å§‹éªŒè¯å†…å®¹å…‹éš†...');

                // æ£€æŸ¥ .themepro-container æ˜¯å¦å­˜åœ¨
                const themeproContainer = document.querySelector('.themepro-container');
                if (themeproContainer) {
                    log('âœ… .themepro-container å­˜åœ¨');
                } else {
                    log('âŒ .themepro-container ä¸å­˜åœ¨');
                    return;
                }

                // æ£€æŸ¥æ‰€æœ‰ .popup å®¹å™¨
                const popupContainers = document.querySelectorAll('.themepro-container .popup');
                log(`ğŸ“¦ æ‰¾åˆ° ${popupContainers.length} ä¸ª .popup å®¹å™¨`);

                popupContainers.forEach((popup, index) => {
                    const childCount = popup.children.length;
                    log(`ğŸ¯ Popup ${index + 1}: ${childCount} ä¸ªå­å…ƒç´ `);

                    if (childCount > 0) {
                        log(`âœ… Popup ${index + 1} åŒ…å«å…‹éš†çš„å†…å®¹`);

                        // åˆ—å‡ºå‰å‡ ä¸ªå­å…ƒç´ çš„ç±»å‹
                        for (let i = 0; i < Math.min(3, popup.children.length); i++) {
                            const child = popup.children[i];
                            const tagName = child.tagName.toLowerCase();
                            const hasContent = child.innerHTML.trim().length > 0;
                            log(`   â””â”€ ${tagName} ${hasContent ? '(æœ‰å†…å®¹)' : '(ç©ºå†…å®¹)'}`);
                        }
                    } else {
                        log(`âŒ Popup ${index + 1} æ²¡æœ‰å†…å®¹`);
                    }
                });

                // æ£€æŸ¥åŸå§‹ .dropdown-content æ˜¯å¦ä¿æŒéšè—
                const originalContents = document.querySelectorAll('.dropdown-content');
                let allHidden = true;

                originalContents.forEach((content, index) => {
                    const isHidden = content.style.visibility === 'hidden';
                    const hasSlotContent = content.querySelector('slot') !== null;
                    log(`ğŸ“‹ åŸå§‹ dropdown-content ${index + 1}: ${isHidden ? 'å·²éšè—' : 'å¯è§'} ${hasSlotContent ? '(æœ‰slot)' : '(æ— slot)'}`);
                    if (!isHidden) allHidden = false;
                });

                if (allHidden) {
                    log('âœ… æ‰€æœ‰åŸå§‹ .dropdown-content éƒ½ä¿æŒ visibility: hidden çŠ¶æ€');
                } else {
                    log('âŒ éƒ¨åˆ† .dropdown-content ä¸æ˜¯ visibility: hidden');
                }

                log('ğŸ‰ å†…å®¹å…‹éš†éªŒè¯å®Œæˆ');
            }

            // ç›‘å¬ç»„ä»¶åˆå§‹åŒ–äº‹ä»¶
            document.addEventListener('DOMContentLoaded', () => {
                log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå®¹å™¨å·²åˆ›å»ºä½†å†…å®¹å…‹éš†å»¶è¿Ÿåˆ°ç‚¹å‡»æ—¶æ‰§è¡Œ');

                // ç«‹å³æ£€æŸ¥åŸºç¡€çŠ¶æ€ï¼ˆç‚¹å‡»å‰ï¼‰
                setTimeout(() => {
                    const themeproContainer = document.querySelector('.themepro-container');
                    const popupContainers = document.querySelectorAll('.themepro-container .popup');

                    log(`ğŸ“¦ åŸºç¡€çŠ¶æ€æ£€æŸ¥:`);
                    log(`   .themepro-container å­˜åœ¨: ${themeproContainer ? 'æ˜¯' : 'å¦'}`);
                    log(`   .popup å®¹å™¨æ•°é‡: ${popupContainers.length}`);

                    popupContainers.forEach((popup, index) => {
                        const childCount = popup.children.length;
                        log(`   Popup ${index + 1} å­å…ƒç´ æ•°é‡: ${childCount} (åº”ä¸º0ï¼Œå› ä¸ºè¿˜æœªç‚¹å‡»)`);
                    });

                    log('ğŸ’¡ ç°åœ¨ç‚¹å‡»ä»»æ„ä¸‹æ‹‰èœå•æŒ‰é’®æ¥è§¦å‘å†…å®¹å…‹éš†');
                }, 500);
            });
        </script>
    </div>
</body>
</html>