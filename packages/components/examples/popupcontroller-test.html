<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>PopupController é‡æ„æµ‹è¯•</title>
        <script type="module" src="../dist/index.js"></script>
        <style>
            body {
                font-family: Arial, sans-serif;
                padding: 20px;
            }
            test-container {
                display: block;
                margin: 20px 0;
            }
        </style>
    </head>
    <body>
        <h1>PopupController é‡æ„æµ‹è¯•</h1>

        <div style="margin: 20px 0">
            <h3>åŸºç¡€åŠŸèƒ½æµ‹è¯•</h3>
            <auto-dropdown
                id="basic-dropdown"
                label="åŸºç¡€ä¸‹æ‹‰èœå•"
                type="primary"
            >
                <div
                    style="
                        padding: 8px 0;
                        min-width: 160px;
                        background: white;
                        border: 1px solid #d9d9d9;
                        border-radius: 6px;
                        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                    "
                >
                    <div style="padding: 8px 16px; cursor: pointer">é€‰é¡¹ 1</div>
                    <div style="padding: 8px 16px; cursor: pointer">é€‰é¡¹ 2</div>
                    <div style="padding: 8px 16px; cursor: pointer">é€‰é¡¹ 3</div>
                </div>
            </auto-dropdown>

            <auto-dropdown
                id="fit-width-dropdown"
                label="å®½åº¦é€‚é…"
                type="success"
            >
                <div
                    style="
                        padding: 8px 0;
                        min-width: 200px;
                        background: white;
                        border: 1px solid #d9d9d9;
                        border-radius: 6px;
                        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                    "
                >
                    <div style="padding: 8px 16px; cursor: pointer">
                        è¿™æ˜¯ä¸€ä¸ªè¾ƒé•¿çš„é€‰é¡¹
                    </div>
                    <div style="padding: 8px 16px; cursor: pointer">
                        å¦ä¸€ä¸ªé€‰é¡¹
                    </div>
                </div>
            </auto-dropdown>

            <auto-dropdown
                id="position-dropdown"
                label="ä½ç½®æµ‹è¯•"
                type="warning"
                placement="top-end"
            >
                <div
                    style="
                        padding: 8px 0;
                        min-width: 120px;
                        background: white;
                        border: 1px solid #d9d9d9;
                        border-radius: 6px;
                        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                    "
                >
                    <div style="padding: 8px 16px; cursor: pointer">ä¸Š</div>
                    <div style="padding: 8px 16px; cursor: pointer">å³</div>
                </div>
            </auto-dropdown>
        </div>

        <div
            id="test-results"
            style="
                margin-top: 20px;
                padding: 10px;
                background: #f5f5f5;
                border-radius: 4px;
            "
        >
            <h3>æµ‹è¯•ç»“æœ</h3>
            <div id="results-content">ç‚¹å‡»ä¸‹æ‹‰èœå•è¿›è¡Œæµ‹è¯•...</div>
        </div>

        <script>
            let testResults = [];

            function log(message, type = "info") {
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
                testResults.push(logEntry);

                const resultsContent =
                    document.getElementById("results-content");
                resultsContent.innerHTML = testResults.join("<br>");
                console.log(logEntry);
            }

            function testContainerCreation() {
                log("ğŸ” æµ‹è¯•å®¹å™¨åˆ›å»º...", "test");

                // æ£€æŸ¥æ˜¯å¦åˆ›å»ºäº† .kylinbits-container
                const themeproContainer = document.querySelector(
                    ".kylinbits-container"
                );
                if (themeproContainer) {
                    log("âœ… .kylinbits-container åˆ›å»ºæˆåŠŸ");
                } else {
                    log("âŒ .kylinbits-container æœªæ‰¾åˆ°");
                    return false;
                }

                // æ£€æŸ¥æ˜¯å¦æœ‰ .popup å®¹å™¨
                const popupContainers = document.querySelectorAll(
                    ".kylinbits-container .popup"
                );
                if (popupContainers.length > 0) {
                    log(`âœ… æ‰¾åˆ° ${popupContainers.length} ä¸ª .popup å®¹å™¨`);
                } else {
                    log("âš ï¸  æš‚æ—  .popup å®¹å™¨ï¼ˆç‚¹å‡»ä¸‹æ‹‰èœå•åä¼šåˆ›å»ºï¼‰");
                }

                return true;
            }

            function testEventHandling() {
                log("ğŸ” æµ‹è¯•äº‹ä»¶å¤„ç†...", "test");

                const dropdowns = document.querySelectorAll("auto-dropdown");
                dropdowns.forEach((dropdown, index) => {
                    // ç›‘å¬ dropdown-show äº‹ä»¶
                    dropdown.addEventListener("dropdown-show", (e) => {
                        log(`âœ… Dropdown ${index + 1}: æ˜¾ç¤ºäº‹ä»¶è§¦å‘`);
                    });

                    // ç›‘å¬ dropdown-hide äº‹ä»¶
                    dropdown.addEventListener("dropdown-hide", (e) => {
                        log(`âœ… Dropdown ${index + 1}: éšè—äº‹ä»¶è§¦å‘`);
                    });

                    // ç›‘å¬ dropdown-toggle äº‹ä»¶
                    dropdown.addEventListener("dropdown-toggle", (e) => {
                        log(
                            `âœ… Dropdown ${index + 1}: åˆ‡æ¢äº‹ä»¶è§¦å‘ï¼ŒçŠ¶æ€: ${
                                e.detail.open
                            }`
                        );
                    });
                });

                log("âœ… äº‹ä»¶ç›‘å¬å™¨è®¾ç½®å®Œæˆ");
            }

            function testContentCloning() {
                log("ğŸ” æµ‹è¯•å†…å®¹å…‹éš†...", "test");

                setTimeout(() => {
                    const popupContainers = document.querySelectorAll(
                        ".kylinbits-container .popup"
                    );

                    popupContainers.forEach((popup, index) => {
                        const childCount = popup.children.length;
                        if (childCount > 0) {
                            log(
                                `âœ… Popup ${
                                    index + 1
                                }: åŒ…å« ${childCount} ä¸ªå…‹éš†å…ƒç´ `
                            );
                        } else {
                            log(`âŒ Popup ${index + 1}: æ²¡æœ‰å…‹éš†å†…å®¹`);
                        }
                    });
                }, 100);
            }

            // é¡µé¢åŠ è½½å®Œæˆåè¿è¡Œæµ‹è¯•
            document.addEventListener("DOMContentLoaded", () => {
                log("ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–æµ‹è¯•");

                // å»¶è¿Ÿæ‰§è¡Œæµ‹è¯•ï¼Œç­‰å¾…ç»„ä»¶åˆå§‹åŒ–
                setTimeout(() => {
                    testContainerCreation();
                    testEventHandling();

                    log("ğŸ“ æµ‹è¯•è¯´æ˜ï¼š");
                    log("1. ç‚¹å‡»ä»»æ„ä¸‹æ‹‰èœå•æŒ‰é’®");
                    log("2. æ£€æŸ¥å®¹å™¨æ˜¯å¦æ­£ç¡®åˆ›å»º");
                    log("3. éªŒè¯å†…å®¹æ˜¯å¦æ­£ç¡®å…‹éš†");
                    log("4. æµ‹è¯•äº‹ä»¶æ˜¯å¦æ­£å¸¸è§¦å‘");
                    log("5. éªŒè¯åŠ¨ç”»å’Œå®šä½æ˜¯å¦æ­£å¸¸");
                    log("ğŸ’¡ ç‚¹å‡»ä¸‹æ‹‰èœå•å¼€å§‹åŠŸèƒ½æµ‹è¯•");
                }, 500);
            });

            // ç›‘å¬ç‚¹å‡»äº‹ä»¶æ¥è§¦å‘å†…å®¹å…‹éš†æµ‹è¯•
            document.addEventListener("click", (e) => {
                if (e.target.closest("auto-dropdown")) {
                    setTimeout(testContentCloning, 50);
                }
            });
        </script>
    </body>
</html>
